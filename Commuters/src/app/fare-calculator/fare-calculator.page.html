<ion-header>
  <ion-toolbar>
    <ion-title>Fare Calculator</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="resetForm()">
        <ion-icon name="refresh"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <form [formGroup]="fareForm">
    <!-- Route Selection -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Select Route</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-item>
          <ion-select 
            formControlName="routeId" 
            placeholder="Choose a route"
            interface="popover">
            <ion-select-option *ngFor="let route of routes" [value]="route.id">
              {{route.name}}
            </ion-select-option>
          </ion-select>
        </ion-item>
      </ion-card-content>
    </ion-card>

    <!-- Origin and Destination -->
    <ion-card *ngIf="fareForm.get('routeId')?.value">
      <ion-card-header>
        <ion-card-title>Trip Details</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <!-- Origin Stop -->
        <ion-item>
          <ion-label position="stacked">From (Origin)</ion-label>
          <ion-select 
            formControlName="originStopId"
            placeholder="Select origin stop"
            interface="popover">
            <ion-select-option 
              *ngFor="let stop of filteredOriginStops" 
              [value]="stop.id">
              {{stop.name}}
            </ion-select-option>
          </ion-select>
        </ion-item>

        <!-- Destination Stop -->
        <ion-item *ngIf="fareForm.get('originStopId')?.value">
          <ion-label position="stacked">To (Destination)</ion-label>
          <ion-select 
            formControlName="destinationStopId"
            placeholder="Select destination stop"
            interface="popover">
            <ion-select-option 
              *ngFor="let stop of filteredDestinationStops" 
              [value]="stop.id">
              {{stop.name}}
            </ion-select-option>
          </ion-select>
        </ion-item>
      </ion-card-content>
    </ion-card>

    <!-- Passenger Details -->
    <ion-card *ngIf="fareForm.get('destinationStopId')?.value">
      <ion-card-header>
        <ion-card-title>Passenger Information</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <!-- Passenger Type -->
        <ion-item>
          <ion-label position="stacked">Passenger Type</ion-label>
          <ion-select 
            formControlName="passengerType"
            interface="popover">
            <ion-select-option 
              *ngFor="let type of passengerTypes" 
              [value]="type.value">
              {{type.label}} 
              <span *ngIf="type.discount > 0">({{type.discount * 100}}% discount)</span>
            </ion-select-option>
          </ion-select>
        </ion-item>

        <!-- Number of Passengers -->
        <ion-item>
          <ion-label position="stacked">Number of Passengers</ion-label>
          <ion-input 
            type="number" 
            formControlName="passengerCount"
            min="1" 
            max="10">
          </ion-input>
        </ion-item>

        <!-- Live Tracking Option -->
        <ion-item>
          <ion-checkbox formControlName="showLiveTracking"></ion-checkbox>
          <ion-label class="ion-margin-start">
            <h3>Enable Live Bus Tracking</h3>
            <p>Track real-time bus location and get arrival updates</p>
          </ion-label>
        </ion-item>
      </ion-card-content>
    </ion-card>
  </form>

  <!-- Bus tracking removed - user doesn't want bus functionality -->
  <!--
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="bus-outline"></ion-icon>
        Active Buses on {{selectedRoute.name}}
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list>
        <ion-item *ngFor="let bus of activeBuses" [class.selected-bus]="selectedBusSchedule?.id === bus.id">
          <ion-avatar slot="start">
            <div class="bus-icon">ðŸšŒ</div>
          </ion-avatar>
          <ion-label>
            <h3>{{bus.licensePlate}} - {{bus.driverName}}</h3>
            <p>Next Stop: {{bus.nextStopName}} ({{bus.estimatedArrival}})</p>
            <p>Passengers: {{bus.passengerCount}}/{{bus.capacity}}</p>
          </ion-label>
          <ion-badge slot="end" [color]="bus.status === 'active' ? 'success' : 'warning'">
            {{bus.status.toUpperCase()}}
          </ion-badge>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>
  -->

  <!-- Fare Details -->
  <ion-card *ngIf="showFareDetails" class="fare-card">
    <ion-card-header>
      <ion-card-title class="fare-title">
        <ion-icon name="receipt-outline"></ion-icon>
        Fare Calculation
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div class="fare-summary">
        <div class="fare-row main-fare">
          <span class="label">Total Fare:</span>
          <span class="value">â‚±{{calculatedFare.toFixed(2)}}</span>
        </div>
        
        <ion-button 
          fill="clear" 
          size="small" 
          (click)="showFareBreakdown()">
          <ion-icon name="information-circle-outline" slot="start"></ion-icon>
          View Breakdown
        </ion-button>
      </div>

      <div class="trip-info">
        <div class="info-row">
          <ion-icon name="location-outline"></ion-icon>
          <span>Distance: {{distance}} km</span>
        </div>
        <div class="info-row">
          <ion-icon name="time-outline"></ion-icon>
          <span>Est. Duration: {{estimatedDuration}}</span>
        </div>
        <div class="info-row">
          <ion-icon name="people-outline"></ion-icon>
          <span>Passengers: {{fareForm.get('passengerCount')?.value}}</span>
        </div>
        <div class="info-row" *ngIf="selectedRoute">
          <ion-icon name="card-outline"></ion-icon>
          <span>Route Base Fare: â‚±{{selectedRoute.basefare}}</span>
        </div>
      </div>

      <!-- Bus tracking removed - user doesn't want bus functionality -->
      <!--
      <div *ngIf="showLiveTracking && selectedBusSchedule" class="live-tracking-info">
        <ion-item-divider>
          <ion-label>
            <h2>ðŸšŒ Recommended Bus</h2>
          </ion-label>
        </ion-item-divider>
        <div class="selected-bus-details">
          <div class="bus-header">
            <h3>{{selectedBusSchedule.licensePlate}} - {{selectedBusSchedule.driverName}}</h3>
            <ion-badge color="success">FASTEST ARRIVAL</ion-badge>
          </div>
          <div class="bus-info">
            <p><strong>Next Stop:</strong> {{selectedBusSchedule.nextStop}}</p>
            <p><strong>Estimated Arrival:</strong> {{selectedBusSchedule.estimatedArrival}}</p>
            <p><strong>Availability:</strong> {{selectedBusSchedule.capacity - selectedBusSchedule.passengerCount}} seats available</p>
          </div>
        </div>
      </div>
      -->

      <ion-button 
        expand="block" 
        color="primary" 
        (click)="proceedToPayment()"
        [disabled]="!fareForm.valid">
        <ion-icon name="card-outline" slot="start"></ion-icon>
        Proceed to Payment
      </ion-button>
    </ion-card-content>
  </ion-card>

  <!-- Help Section -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="help-circle-outline"></ion-icon>
        How It Works
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list>
        <ion-item>
          <ion-icon name="checkmark-circle" slot="start" color="success"></ion-icon>
          <ion-label>
            <h3>Base Fare: â‚±15.00</h3>
            <p>Starting fare for all routes</p>
          </ion-label>
        </ion-item>
        <ion-item>
          <ion-icon name="checkmark-circle" slot="start" color="success"></ion-icon>
          <ion-label>
            <h3>Distance Rate: â‚±2.50/km</h3>
            <p>Additional charge per kilometer</p>
          </ion-label>
        </ion-item>
        <ion-item>
          <ion-icon name="checkmark-circle" slot="start" color="success"></ion-icon>
          <ion-label>
            <h3>Discounts Available</h3>
            <p>20% off for students and senior citizens</p>
          </ion-label>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>
</ion-content>